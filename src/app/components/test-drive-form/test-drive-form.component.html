<div class="container">
  <div class="success-message" *ngIf="showSuccess">
    <div class="confirmation-container">
      <div class="success-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor" class="bi bi-check-lg" viewBox="0 0 16 16">
          <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/>
        </svg>
      </div>
      
      <h1 class="confirmation-title">Test Drive Agendado!</h1>
      <p class="confirmation-subtitle">
          Sua solicita√ß√£o foi recebida com sucesso. Nossa equipe entrar√° em contato em breve para confirmar todos os detalhes da sua experi√™ncia.
      </p>

      <div class="protocol-number">
          C√≥digo: #TD2024-<span id="protocolNumber">{{codigo}}</span>
      </div>

      <div class="confirmation-details">
          <div class="detail-item">
              <span class="detail-label">Nome:</span>
              <span class="detail-value" id="customerName">{{this.dataForm.name}}</span>
          </div>
          <div class="detail-item">
              <span class="detail-label">E-mail:</span>
              <span class="detail-value" id="customerEmail">{{this.dataForm.email}}</span>
          </div>
          <div class="detail-item">
              <span class="detail-label">Telefone:</span>
              <span class="detail-value" id="customerPhone">{{this.dataForm.phone}}</span>
          </div>
          <div class="detail-item">
              <span class="detail-label">Marca de Interesse:</span>
              <span class="detail-value" id="selectedBrand">{{this.dataForm.brand}}</span>
          </div>
          <div class="detail-item">
              <span class="detail-label">Modelo:</span>
              <span class="detail-value" id="selectedModel">{{this.dataForm.bmwModel}} {{this.dataForm.mercedesModel}} {{this.dataForm.fordModel}}</span>
          </div>
          <div class="detail-item">
              <span class="detail-label">Data Preferencial:</span>
              <span class="detail-value" id="preferredDate">{{this.dataForm.preferredDate}}</span>
          </div>
          <div class="detail-item">
              <span class="detail-label">Hor√°rio:</span>
              <span class="detail-value" id="preferredTime">{{this.dataForm.preferredTime}}</span>
          </div>
      </div>

      <div class="next-steps">
          <h3>Pr√≥ximos Passos:</h3>
          <ol class="steps-list">
              <li>Nossa equipe analisar√° sua solicita√ß√£o em at√© 24 horas</li>
              <li>Entraremos em contato via telefone para confirmar disponibilidade</li>
              <li>Enviaremos um e-mail com todos os detalhes do agendamento</li>
              <li>No dia do test drive, lembre-se de trazer sua CNH v√°lida</li>
          </ol>
      </div>

      <div class="contact-info">
          <h4>Precisa de ajuda?</h4>
          <p><strong>Telefone:</strong> (71) 9 8483-8928</p>
          <p><strong>WhatsApp:</strong> (71) 9 8483-8928</p>
          <p><strong>E-mail:</strong> specdrive&commat;concessionaria.com</p>
      </div>

      <div class="action-buttons">
          <a (click)="HomeRouter()" class="btn btn-primary">
              Voltar ao In√≠cio
          </a>
          <a (click)="backtestDrive()" class="btn btn-secondary">
              Agendar Outro Test Drive
          </a>
      </div>
  </div>
  </div>
  
  <p>Quer sentir a emo√ß√£o de dirigir o carro dos seus sonhos? Preencha o formul√°rio abaixo e agende um test drive com um de nossos ve√≠culos premium. Nossa equipe entrar√° em contato para confirmar sua experi√™ncia.</p>
  
  <form [formGroup]="testDriveForm" (ngSubmit)="onSubmit()">
    <h2>Informa√ß√µes Pessoais</h2>
    
    <div class="form-group">
      <label for="name">Nome Completo*</label>
      <input type="text" id="name" formControlName="name">
      <div class="error-message" *ngIf="testDriveForm.get('name')?.invalid && testDriveForm.get('name')?.touched">
        Nome completo √© obrigat√≥rio
      </div>
    </div>
    
    <div class="form-group">
      <label for="email">E-mail*</label>
      <input type="email" id="email" formControlName="email">
      <div class="error-message" *ngIf="testDriveForm.get('email')?.invalid && testDriveForm.get('email')?.touched">
        E-mail v√°lido √© obrigat√≥rio
      </div>
    </div>
    
    <div class="form-group">
      <label for="phone">Telefone*</label>
      <input type="tel" id="phone" formControlName="phone" mask="(00) 0 0000-0000" placeholder="(00) 00000-0000">
      <div class="error-message" *ngIf="testDriveForm.get('phone')?.invalid && testDriveForm.get('phone')?.touched">
        Telefone √© obrigat√≥rio
      </div>
    </div>
    
    <div class="form-group">
      <label for="CPF">CPF*</label>
      <input type="text" id="CPF" formControlName="CPF" mask="000.000.000-00" placeholder="000.000.000-00">
      <div class="error-message" *ngIf="testDriveForm.get('CPF')?.invalid && testDriveForm.get('CPF')?.touched">
        CPF √© obrigat√≥rio
      </div>
    </div>
    
    <h2>Dados para Test Drive</h2>
    
    <div class="form-group">
      <label for="brand">Marca de Interesse*</label>
      <select id="brand" formControlName="brand">
        <option value="">Selecione uma marca</option>
        <option value="bmw">BMW</option>
        <option value="mercedes">Mercedes-Benz</option>
        <option value="ford">Ford</option>
      </select>
      <div class="error-message" *ngIf="testDriveForm.get('brand')?.invalid && testDriveForm.get('brand')?.touched">
        Selecione uma marca
      </div>
    </div>
    
    <div class="form-group" *ngIf="selectedBrand === 'bmw'">
      <label for="bmwModel">Modelo BMW*</label>
      <select id="bmwModel" formControlName="bmwModel">
        <option value="">Selecione um modelo</option>
        <option *ngFor="let model of bmwModels" [value]="model.value">{{ model.name }}</option>
      </select>
      <div class="error-message" *ngIf="testDriveForm.get('bmwModel')?.invalid && testDriveForm.get('bmwModel')?.touched">
        Selecione um modelo
      </div>
    </div>
    
    <div class="form-group" *ngIf="selectedBrand === 'mercedes'">
      <label for="mercedesModel">Modelo Mercedes-Benz*</label>
      <select id="mercedesModel" formControlName="mercedesModel">
        <option value="">Selecione um modelo</option>
        <option *ngFor="let model of mercedesModels" [value]="model.value">{{ model.name }}</option>
      </select>
      <div class="error-message" *ngIf="testDriveForm.get('mercedesModel')?.invalid && testDriveForm.get('mercedesModel')?.touched">
        Selecione um modelo
      </div>
    </div>
    
    <div class="form-group" *ngIf="selectedBrand === 'ford'">
      <label for="fordModel">Modelo Ford*</label>
      <select id="fordModel" formControlName="fordModel">
        <option value="">Selecione um modelo</option>
        <option *ngFor="let model of fordModels" [value]="model.value">{{ model.name }}</option>
      </select>
      <div class="error-message" *ngIf="testDriveForm.get('fordModel')?.invalid && testDriveForm.get('fordModel')?.touched">
        Selecione um modelo
      </div>
    </div>
    
    <div class="form-group">
      <label for="preferredDate">Data Preferencial*</label>
      <input type="date" id="preferredDate" formControlName="preferredDate">
      <div class="error-message" *ngIf="testDriveForm.get('preferredDate')?.invalid && testDriveForm.get('preferredDate')?.touched">
        Selecione uma data
      </div>
    </div>
    
    <div class="form-group">

      <!-- <label for="preferredTime">Hor√°rio Preferencial*</label>
      <select id="preferredTime" formControlName="preferredTime">
        <option value="">Selecione um hor√°rio</option>
        <option value="manh√£">Manh√£ (09:00 - 12:00)</option>
        <option value="tarde">Tarde (13:00 - 18:00)</option>
      </select>
      <div class="error-message" *ngIf="testDriveForm.get('preferredTime')?.invalid && testDriveForm.get('preferredTime')?.touched">
        Selecione um hor√°rio
      </div> -->

      

              <h3>Data e Hor√°rio</h3>
              
              <div class="form-group">
                <label for="date">Data *</label>
                <input 
                  type="date" 
                  id="date"
                  formControlName="date"
                  [min]="minDate"
                  [max]="maxDate"
                  (change)="onDateChange()"
                  [class.error]="testDriveForm.get('date')?.invalid && testDriveForm.get('date')?.touched">
                <div class="error-message" *ngIf="testDriveForm.get('date')?.invalid && testDriveForm.get('date')?.touched">
                  Data √© obrigat√≥ria
                </div>
              </div>

              <!-- Sele√ß√£o de Hor√°rio -->
              <div class="form-group" >
                <label>Hor√°rios Dispon√≠veis *</label>
                <div class="time-slots">
                  <button 
                    type="button"
                    *ngFor="let slot of availableTimeSlots"
                    class="time-slot"
                    [class.selected]="testDriveForm.get('preferredTime')?.value === slot.time"
                    [class.unavailable]="!slot.available"
                    [disabled]="!slot.available"
                    (click)="selectTime(slot.time)">
                    {{ slot.time }}
                  </button>
                </div>
                <div class="error-message" *ngIf="testDriveForm.get('preferredTime')?.invalid && testDriveForm.get('preferredTime')?.touched">
                  Selecione um hor√°rio
                </div>
              </div>

          </div>

        

            <div class="confirmation-actions">
              <button class="btn btn-primary" (click)="viewAppointments()">
                Ver Agendamentos
              </button>
            </div>

        <!-- Lista de Agendamentos -->
        <div class="card" *ngIf="currentStep === 'list'">
          <div class="appointments-header">
            <h2>Agendamentos</h2>
            <button class="btn btn-primary" (click)="newAppointment()">
              Novo Agendamento
            </button>
          </div>

          <div class="appointments-list" *ngIf="appointments.length > 0">
            <div class="appointment-item" *ngFor="let appointment of appointments">
              <div class="appointment-info">
                <div class="appointment-datetime">
                  <div class="date">üìÖ {{ formatDate(appointment.preferredDate) }}</div>
                  <div class="time">üïê {{ appointment.preferredTime }}</div>
                </div>
                <div class="appointment-status">
                  <span class="status-badge" [ngClass]="'status-' + appointment.status">
                    {{ appointment.status }}
                  </span>
                </div>
              </div>
              <div class="appointment-actions">
                <button class="btn btn-small btn-outline" (click)="editAppointment(appointment)">
                  Editar
                </button>
                <button class="btn btn-small btn-danger" (click)="cancelAppointment(appointment.id)">
                  Cancelar
                </button>
              </div>
            </div>
          </div>

          <div class="empty-state" *ngIf="appointments.length === 0">
            <div class="empty-icon">üìÖ</div>
            <h3>Nenhum agendamento encontrado</h3>
            <p>Fa√ßa seu primeiro agendamento de test drive!</p>
          </div>
        </div>
    
    <div class="form-group">
      <label>Possui CNH?*</label>
      <div class="radio-group">
        <div class="radio-option">
          <input type="radio" id="cnh-yes" formControlName="hasCNH" value="sim">
          <label for="cnh-yes">Sim</label>
        </div>
        <div class="radio-option">
          <input type="radio" id="cnh-no" formControlName="hasCNH" value="nao">
          <label for="cnh-no">N√£o</label>
        </div>
      </div>
      <div class="error-message" *ngIf="testDriveForm.get('hasCNH')?.invalid && testDriveForm.get('hasCNH')?.touched">
        Informe se possui CNH
      </div>
    </div>
    
    <div class="form-group">
      <label for="comments">Coment√°rios Adicionais</label>
      <textarea id="comments" formControlName="comments" rows="4"></textarea>
    </div>
    
    <div class="form-group">
      <div class="radio-option">
        <input type="checkbox" id="terms" formControlName="terms">
        <label for="terms">Concordo com os <a (click)="navigationTerms()">Termos e Condi√ß√µes</a>*</label>
      </div>
      <div class="error-message" *ngIf="testDriveForm.get('terms')?.invalid && testDriveForm.get('terms')?.touched">
        Voc√™ precisa concordar com os termos
      </div>
    </div>
    
    <button type="submit">Agendar Test Drive</button>
  </form>
</div>